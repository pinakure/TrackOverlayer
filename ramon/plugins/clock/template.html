<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="./css/{% name %}.css"/>
        <style>
            {% fonts %}
            * {
                position                  : absolute;
                left                      : 0px;
                top                       : 0px;
                padding                   : 0px 0px 0px 0px;
                margin                    : 0px 0px 0px 0px;
                font-size                 : var(--digits-font-size);
                font-family               : var(--digits-font);   
                color                     : var(--digits-color);  
                font-weight               : var(--digits-font-bold);          
                font-style                : var(--digits-font-italic);
                line-height               : var(--digits-line-height);
                text-shadow               : var(--digits-shadow-pos-x) var(--digits-shadow-pos-y) var(--digits-shadow-blur) var(--digits-shadow-color);
                -webkit-text-stroke       : var(--digits-border-width);
                -webkit-text-stroke-color : var(--digits-border-color);
            }
        </style>        
    </head>
    <body style="overflow:hidden;">
        <div class="{% name %}" id="{% name %}">00:00:00</div>    
        <script>
            {% plugin %}

            var {% Name %} = {
                // TODO: more clock modes, including 'set a variable to catch by another plugin
                //       when a set alarm is reach', for example
                mode            : '{% clock-type %}',
                alarm           : Date('01/01/01 {% clock-alarm %}'),
                
                dom             : {
                    {% name %}      : document.getElementById('{% name %}'),
                },

                {% framework %}
                
                update_clock    : function( date ){
                    return `${date}`.split('GMT')[0].split(' ')[4];
                },
                
                update_alarm    : function( date ){
                    {% Name %}.alarm = Date(`01/01/01 ${{% Name %}.settings["clock-alarm"] }`);
                    return `${date}`.split('GMT')[0].split(' ')[4];
                },
                
                update_countdown: function( date ){
                    now = `01/01/01 `+`${date}`.split('GMT')[0].split(' ')[4];
                    {% Name %}.alarm = Date(`01/01/01 ${{% Name %}.settings["clock-alarm"] }`);
                    diff = {% Name %}.alarm - now;
                    return `${diff}`.split('GMT')[0].split(' ')[4];
                },

                update          : function(){
                    var date = new Date;
                    mode = {% Name %}.mode.split('.')[2];
                    {% Name %}.dom.{% name %}.innerHTML = eval(`{% Name %}Mode.${mode}.second_callback(date)`)
                    if( {% Name %}.standalone ) { setTimeout({% Name %}.update, 1000);}
                },

                start : function( clock_mode ){
                    {% Name %}.mode = clock_mode;
                    {% Name %}.loadSettings();
                    {% Name %}.settings.update = { rate : 1 };
                    //{% Name %}.messageHandler();
                    
                    window.addEventListener( 'message', function(e){ 
                        if(e.data.split('|')[0]=='update-css'){
                            var rid = parseInt(Math.random()*655356);
                            var par  = document.getElementsByTagName('head')[0];
                            var old  = document.getElementsByTagName('link')[0];
                            var link = document.createElement('link');
                            link.rel = "stylesheet";
                            link.type = "text/css";
                            link.href = `./{% name %}.css?${ rid }`;
                            par.append(link);
                            {% Name %}.log.print("style updated");
                        }
                    });
                        
                    window.addEventListener( 'load', function(e){ 
                        {% Name %}.update();
                    });
                    
                },
            };
            var {% Name %}Mode = {
                'clock' : {
                    second_callback : {% Name %}.update_clock,
                },
                'timer' : {
                    second_callback : {% Name %}.update_alarm,
                },
                'countdown' : {
                    second_callback : {% Name %}.update_countdown,
                },
            };
            {% Name %}.start('{% clock-type %}');
        </script>
    </body>
</html>