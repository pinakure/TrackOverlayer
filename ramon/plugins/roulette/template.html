<!DOCTYPE html>
    <html type="plugin" version="0.?" author="smiker@m4gtracker.com">
    <head>
        <link rel="stylesheet" type="text/css" href="./css/{% name %}.css">
        <title>{% Name %}</title>
        <style>
            {% fonts %}
            {% fullsized %}
            * {
                padding: 0px;
                margin:0px;
                box-sizing: border-box;
                user-select: none;
            }
            body {
                perspective: 1800px;
                overflow: hidden;
                perspective-origin: 50% 50%;
            }
            
            #{% name %}{
                transform: translateZ(-500px) translateY( calc( var(--size-x) / 2 ) ) rotateX(56deg);
            }

            #output {
                overflow: hidden;
                z-index : 1000;
                position: absolute;
                display: inline-block;
                width   : var(--size-x);
                height  : var(--size-x);
                top     : calc( 50% - calc( var(--size-x) / 2 ) );
                left    : calc( 50% - calc( var(--size-x) / 2 ) );
                border-radius: 50%;
                border: 1px solid #000;
                box-shadow: 0px 0px 8px #000c;
            }
            .slice {
                display             : inline-block;
                /*background-image    : linear-gradient(-270deg, #ffffff80 30%, #00000080, #ffffff80 70%);*/
                background-image    : linear-gradient(-270deg, #ffffff80, #00000080);
                position            : absolute;
                top                 : 50%;
                left                : 50%;
                width               : 60%;
                height              : 60%;
                clip-path           : polygon( 0%   0%, 100%   0%,100% 100%,0%   0%);
            }
            .slice:nth-child(1){    transform-origin: top left; transform: rotateZ(  0deg );  background-color: #ff0000; }
            .slice:nth-child(2){    transform-origin: top left; transform: rotateZ( 45deg );  background-color: #ffff00; }
            .slice:nth-child(3){    transform-origin: top left; transform: rotateZ( 90deg );  background-color: #802020; }
            .slice:nth-child(4){    transform-origin: top left; transform: rotateZ(135deg );  background-color: #ffc020; }
            .slice:nth-child(5){    transform-origin: top left; transform: rotateZ(180deg );  background-color: #00ff00; }
            .slice:nth-child(6){    transform-origin: top left; transform: rotateZ(225deg );  background-color: #00ffff; }
            .slice:nth-child(7){    transform-origin: top left; transform: rotateZ(270deg );  background-color: #0000ff; }
            .slice:nth-child(8){    transform-origin: top left; transform: rotateZ(315deg );  background-color: #a020ff; }
            
            .slice span { 
                transform-origin        : top left;
                display                 : inline-block; 
                position                : absolute; 
                top                     : 0.5%; 
                left                    : 8%; 
                text-align              : center;
                transform               : rotateZ( 29deg ); 
                font-size               : 17px; 
                font-family             : 'noir-caps'; 
                text-overflow           : hidden;
                height                  : 28px;/*line-height*/
                width                   : 100%;
                overflow                : hidden;
            }

            .rolling {
                animation-name: rolling;
                animation-duration: 1s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite; 
                animation-direction: normal;
                animation-play-state: running;
                animation-fill-mode: forwards;
            }
            
            .starting {
                animation-name: rolling;
                animation-duration: 2s;
                animation-timing-function: ease-in;
                animation-delay: 0s;
                animation-iteration-count: 1; 
                animation-direction: normal;
                animation-play-state: running;
                animation-fill-mode: forwards;
            }
            
            .stopping {
                animation-name: rolling;
                animation-duration: 5s;
                animation-timing-function: ease-out;
                animation-delay: 0s;
                animation-iteration-count: 1; 
                animation-direction: normal;
                animation-play-state: running;
                animation-fill-mode: forwards;
            }

            @keyframes rolling {
                  0% { transform: rotateZ(  0deg); }
                100% { transform: rotateZ(360deg); }
            }
            
            @keyframes stopping {
                  0% {                             }
                100% { transform: rotateZ(360deg); }
            }

        </style>
    </head>
    <body>
        <div id="{% name %}">
            <div id="output" class="" onclick="{% Name %}.action.handle(this)">
                <div id="slot[0]" class="slice"><span>SLOT 1 LONG ENOUGH TO REACH THE END OF THE WHEEL</span></div>
                <div id="slot[1]" class="slice"><span>SLOT 2</span></div>
                <div id="slot[2]" class="slice"><span>SLOT 3</span></div>
                <div id="slot[3]" class="slice"><span>SLOT 4</span></div>
                <div id="slot[4]" class="slice"><span>SLOT 5</span></div>
                <div id="slot[5]" class="slice"><span>SLOT 6</span></div>
                <div id="slot[6]" class="slice"><span>SLOT 7</span></div>
                <div id="slot[7]" class="slice"><span>SLOT 8</span></div>
            </div>
        </div>        
        
        <script>
            {% plugin %}

            var {% Name %} = {
                
                running  : false,
                stopping : false,

                data : {
                    
                },

                dom : {
                    {% name %}      : document.getElementById('{% name %}'),
                    output          : document.getElementById('output'),
                },

                {% framework %}
                
       
                update : function(){
                    {% Name %}.socket.send(`get-${ {% Name %}.endpoint }`);       
                },

                render : function(){

                },

                action : {
                    handle : function(){
                        if ((  {% Name %}.dom.output.className=="" )||({% Name %}.dom.output.className=="rolling")){
                            if( {% Name %}.running ) {% Name %}.action.stop();
                            else {% Name %}.action.start();
                        }
                    },

                    start : function(){
                        console.log("Starting...");
                        if( {% Name %}.running ) return;
                        {% Name %}.running = true;
                        {% Name %}.dom.output.style.animationPlayState = 'running';
                        {% Name %}.dom.output.className = 'starting';
                        setTimeout(function(){
                            console.log("Rolling...");
                            {% Name %}.dom.output.className = 'rolling';
                        }, 2000);
                    },
                    stop : function(){
                        if( {% Name %}.stopping) return;
                        console.log("Stopping...");
                        {% Name %}.running = false;
                        {% Name %}.dom.output.style.animationPlayState = 'paused';
                        
                        return;
                        {% Name %}.stopping = true;
                        {% Name %}.dom.output.style.animationTimingFuncion = 'ease-out';
                        {% Name %}.dom.output.style.animationDuration      = '5s';
                        //{% Name %}.dom.output.className = 'stopping';
                        setTimeout(function(){
                            console.log("Ready");
                            {% Name %}.dom.output.className = '';
                            {% Name %}.stopping = false;
                            {% Name %}.dom.output.style.animationTimingFuncion = '';
                        {% Name %}.dom.output.style.animationDuration      = '';
                        }, 5000);
                    },
                },

                {% websocket %}
                
                socketHandle : function( event ){
                    payload = JSON.parse(event.data);
                    if(payload.response=={% Name %}.endpoint){
                        console.log("WS ({% Name %}) : Got new roulette data : ", payload.data)
                        {% Name %}.data = JSON.parse(payload.data);
                        {% Name %}.render();
                        setTimeout( {% Name %}.update, 5000 );
                    }
                },
                
                start : function(){
                    {% Name %}.loadSettings();
                    {% Name %}.messageHandler();
                    {% Name %}.connect();
                    /*{% Name %}.action.start();*/
                }
            }
            // Dont forget to start the plugin after defining its class!
            {% Name %}.start()
        </script>
        {% monitor %}
    </body>
</html>